{"version":3,"file":"audio-processor.mjs","sources":["../src/audio-processor.mjs"],"sourcesContent":["class audioProcessor extends AudioWorkletProcessor {\r\n\tconstructor(...args) {\r\n\t\tsuper(...args);\r\n\t\tthis.audioSample = 0;\r\n\t\tthis.byteSample = 0;\r\n\t\tthis.drawMode = 'Points';\r\n\t\tthis.errorDisplayed = true;\r\n\t\tthis.func = null;\r\n\t\tthis.getValues = null;\r\n\t\tthis.isFuncbeat = false;\r\n\t\tthis.isPlaying = false;\r\n\t\tthis.lastByteValue = [null, null];\r\n\t\tthis.lastFuncValue = [null, null];\r\n\t\tthis.lastTime = -1;\r\n\t\tthis.outValue = [0, 0];\r\n\t\tthis.playbackSpeed = 1;\r\n\t\tthis.sampleRate = 8000;\r\n\t\tthis.sampleRatio = 1;\r\n\t\tthis.srDivisor = 1;\r\n\t\tthis.fftBuffer = [];\r\n\t\tthis.fftSize = 256;\r\n\t\tthis.audioFiles = new Map();\r\n\t\tObject.seal(this);\r\n\t\taudioProcessor.deleteGlobals();\r\n\t\taudioProcessor.freezeGlobals();\r\n\t\tthis.port.addEventListener('message', e => this.receiveData(e.data));\r\n\t\tthis.port.start();\r\n\t}\r\n\tstatic deleteGlobals() {\r\n\t\t// Delete single letter variables to prevent persistent variable errors (covers a good enough range)\r\n\t\tfor(let i = 0; i < 26; ++i) {\r\n\t\t\tdelete globalThis[String.fromCharCode(65 + i)];\r\n\t\t\tdelete globalThis[String.fromCharCode(97 + i)];\r\n\t\t}\r\n\t\t// Delete global variables\r\n\t\tfor(const name in globalThis) {\r\n\t\t\tif(Object.prototype.hasOwnProperty.call(globalThis, name)) {\r\n\t\t\t\tdelete globalThis[name];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tstatic freezeGlobals() {\r\n\t\tObject.getOwnPropertyNames(globalThis).forEach(name => {\r\n\t\t\tconst prop = globalThis[name];\r\n\t\t\tconst type = typeof prop;\r\n\t\t\tif((type === 'object' || type === 'function') && name !== 'globalThis') {\r\n\t\t\t\tObject.freeze(prop);\r\n\t\t\t}\r\n\t\t\tif(type === 'function' && Object.prototype.hasOwnProperty.call(prop, 'prototype')) {\r\n\t\t\t\tObject.freeze(prop.prototype);\r\n\t\t\t}\r\n\t\t\tObject.defineProperty(globalThis, name, { writable: false, configurable: false });\r\n\t\t});\r\n\t}\r\n\tstatic getErrorMessage(err, time) {\r\n\t\tconst when = time === null ? 'compilation' : 't=' + time;\r\n\t\tif(!(err instanceof Error)) {\r\n\t\t\treturn `${ when } thrown: ${ typeof err === 'string' ? err : JSON.stringify(err) }`;\r\n\t\t}\r\n\t\tconst { message, lineNumber, columnNumber } = err;\r\n\t\treturn `${ when } error: ${ typeof message === 'string' ? message : JSON.stringify(message) }${\r\n\t\t\ttypeof lineNumber === 'number' && typeof columnNumber === 'number' ?\r\n\t\t\t\t` (at line ${ lineNumber - 3 }, character ${ +columnNumber })` : '' }`;\r\n\t}\r\n\tprocess(inputs, [chData]) {\r\n\t\tconst chDataLen = chData[0].length;\r\n\t\tif(!chDataLen || !this.isPlaying) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tlet time = this.sampleRatio * this.audioSample;\r\n\t\tlet { byteSample } = this;\r\n\t\tconst drawBuffer = [];\r\n\t\tconst isDiagram = this.drawMode === 'Combined' || this.drawMode === 'Diagram';\r\n\t\tfor(let i = 0; i < chDataLen; ++i) {\r\n\t\t\ttime += this.sampleRatio;\r\n\t\t\t// make sure you dont modify this because it will mess up the scope\r\n\t\t\tconst currentTime = Math.floor(time);\r\n\t\t\tif(this.lastTime !== currentTime) {\r\n\t\t\t\tlet funcValue;\r\n\t\t\t\tconst currentSample = Math.floor(byteSample/this.srDivisor) * this.srDivisor;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif(this.isFuncbeat) {\r\n\t\t\t\t\t\tfuncValue = this.func(currentSample/this.sampleRate, this.sampleRate/this.srDivisor);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfuncValue = this.func(currentSample);\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch(err) {\r\n\t\t\t\t\tif(this.errorDisplayed) {\r\n\t\t\t\t\t\tthis.errorDisplayed = false;\r\n\t\t\t\t\t\tthis.sendData({\r\n\t\t\t\t\t\t\terror: {\r\n\t\t\t\t\t\t\t\tmessage: audioProcessor.getErrorMessage(err, currentSample),\r\n\t\t\t\t\t\t\t\tisRuntime: true\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfuncValue = NaN;\r\n\t\t\t\t}\r\n\t\t\t\tfuncValue = Array.isArray(funcValue) ? [funcValue[0], funcValue[1]] : [funcValue, funcValue];\r\n\t\t\t\tlet hasValue = false;\r\n\t\t\t\tlet ch = 2;\r\n\t\t\t\twhile(ch--) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tfuncValue[ch] = +funcValue[ch];\r\n\t\t\t\t\t} catch(err) {\r\n\t\t\t\t\t\tfuncValue[ch] = NaN;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(isDiagram) {\r\n\t\t\t\t\t\tif(!isNaN(funcValue[ch])) {\r\n\t\t\t\t\t\t\tthis.outValue[ch] = this.getValues(funcValue[ch], ch);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.lastByteValue[ch] = NaN;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\thasValue = true;\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(funcValue[ch] === this.lastFuncValue[ch]) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t} else if(!isNaN(funcValue[ch])) {\r\n\t\t\t\t\t\tthis.outValue[ch] = this.getValues(funcValue[ch], ch);\r\n\t\t\t\t\t\thasValue = true;\r\n\t\t\t\t\t} else if(!isNaN(this.lastFuncValue[ch])) {\r\n\t\t\t\t\t\tthis.lastByteValue[ch] = NaN;\r\n\t\t\t\t\t\thasValue = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(hasValue) {\r\n\t\t\t\t\tdrawBuffer.push({ t: byteSample, value: [...this.lastByteValue] });\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbyteSample += currentTime - this.lastTime;\r\n\t\t\t\tthis.lastFuncValue = funcValue;\r\n\t\t\t\tthis.lastTime = currentTime;\r\n\t\t\t}\r\n\t\t\tchData[0][i] = this.outValue[0];\r\n\t\t\tchData[1][i] = this.outValue[1];\r\n\t\t}\r\n\t\tif(Math.abs(byteSample) > Number.MAX_SAFE_INTEGER) {\r\n\t\t\tthis.resetTime();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tthis.audioSample += chDataLen;\r\n\t\tlet isSend = false;\r\n\t\tconst data = {};\r\n\t\tif(byteSample !== this.byteSample) {\r\n\t\t\tisSend = true;\r\n\t\t\tdata.byteSample = this.byteSample = byteSample;\r\n\t\t}\r\n\t\tif(drawBuffer.length) {\r\n\t\t\tisSend = true;\r\n\t\t\tdata.drawBuffer = drawBuffer;\r\n\t\t\t// Collect samples for FFT\r\n\t\t\tfor(const sample of drawBuffer) {\r\n\t\t\t\tthis.fftBuffer.push((sample.value[0] + sample.value[1]) / 2);\r\n\t\t\t}\r\n\t\t\tif(this.fftBuffer.length >= this.fftSize) {\r\n\t\t\t\tdata.fftData = this.fftBuffer.slice(-this.fftSize);\r\n\t\t\t\tthis.fftBuffer = this.fftBuffer.slice(-this.fftSize);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(isSend) {\r\n\t\t\tthis.sendData(data);\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\treceiveData(data) {\r\n\t\tif(data.byteSample !== undefined) {\r\n\t\t\tthis.byteSample = +data.byteSample || 0;\r\n\t\t\tthis.resetValues();\r\n\t\t}\r\n\t\tif(data.errorDisplayed === true) {\r\n\t\t\tthis.errorDisplayed = true;\r\n\t\t}\r\n\t\tif(data.isPlaying !== undefined) {\r\n\t\t\tthis.isPlaying = data.isPlaying;\r\n\t\t}\r\n\r\n\t\tif(data.srDivisor !== undefined) {\r\n\t\t\tthis.srDivisor = data.srDivisor;\r\n\t\t}\r\n\t\tif(data.playbackSpeed !== undefined) {\r\n\t\t\tconst sampleRatio = this.sampleRatio / this.playbackSpeed;\r\n\t\t\tthis.playbackSpeed = data.playbackSpeed;\r\n\t\t\tthis.setSampleRatio(sampleRatio);\r\n\t\t}\r\n\t\tif(data.mode !== undefined) {\r\n\t\t\tthis.isFuncbeat = data.mode === 'Funcbeat';\r\n\t\t\tswitch(data.mode) {\r\n\t\t\tcase 'Bytebeat':\r\n\t\t\t\tthis.getValues = (funcValue, ch) => (this.lastByteValue[ch] = funcValue & 255) / 127.5 - 1;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Signed Bytebeat':\r\n\t\t\t\tthis.getValues = (funcValue, ch) =>\r\n\t\t\t\t\t(this.lastByteValue[ch] = (funcValue + 128) & 255) / 127.5 - 1;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Floatbeat':\r\n\t\t\tcase 'Funcbeat':\r\n\t\t\t\tthis.getValues = (funcValue, ch) => {\r\n\t\t\t\t\tconst outValue = Math.max(Math.min(funcValue, 1), -1);\r\n\t\t\t\t\tthis.lastByteValue[ch] = Math.round((outValue + 1) * 127.5);\r\n\t\t\t\t\treturn outValue;\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tdefault: this.getValues = (funcValue, ch) => (this.lastByteValue[ch] = NaN);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(data.drawMode !== undefined) {\r\n\t\t\tthis.drawMode = data.drawMode;\r\n\t\t}\r\n\t\tif(data.setFunction !== undefined) {\r\n\t\t\tthis.setFunction(data.setFunction);\r\n\t\t}\r\n\t\tif(data.resetTime === true) {\r\n\t\t\tthis.resetTime();\r\n\t\t}\r\n\t\tif(data.sampleRate !== undefined) {\r\n\t\t\tthis.sampleRate = data.sampleRate;\r\n\t\t}\r\n\t\tif(data.sampleRatio !== undefined) {\r\n\t\t\tthis.setSampleRatio(data.sampleRatio);\r\n\t\t}\r\n\t\tif(data.audioFiles !== undefined) {\r\n\t\t\tthis.audioFiles = new Map(data.audioFiles);\r\n\t\t}\r\n\t}\r\n\tsendData(data) {\r\n\t\tthis.port.postMessage(data);\r\n\t}\r\n\tresetTime() {\r\n\t\tthis.byteSample = 0;\r\n\t\tthis.resetValues();\r\n\t\tthis.sendData({ byteSample: 0 });\r\n\t}\r\n\tresetValues() {\r\n\t\tthis.audioSample = 0;\r\n\t\tthis.lastByteValue = this.lastFuncValue = [null, null];\r\n\t\tthis.lastTime = -1;\r\n\t\tthis.outValue = [0, 0];\r\n\t}\r\n\tsetFunction(codeText) {\r\n\t\t// Create shortened Math functions\r\n\t\tconst params = Object.getOwnPropertyNames(Math);\r\n\t\tconst values = params.map(k => Math[k]);\r\n\t\t\r\n\t\tconst funcs = {\r\n\t\t\t/*bit*/        \"bitC\": function (x, y, z) { return x & y ? z : 0 },\r\n\t\t\t/*bit reverse*/\"br\": function (x, size = 8) {\r\n\t\t\t\tif (size > 32) { throw new Error(\"br() Size cannot be greater than 32\") } else {\r\n\t\t\t\t\tlet result = 0;\r\n\t\t\t\t\tfor (let idx = 0; idx < (size - 0); idx++) {\r\n\t\t\t\t\t\tresult += funcs.bitC(x, 2 ** idx, 2 ** (size - (idx + 1)))\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn result\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t/*sin that loops every 128 \"steps\", instead of every pi steps*/\"sinf\": function (x) { return Math.sin(x / (128 / Math.PI)) },\r\n\t\t\t/*cos that loops every 128 \"steps\", instead of every pi steps*/\"cosf\": function (x) { return Math.cos(x / (128 / Math.PI)) },\r\n\t\t\t/*tan that loops every 128 \"steps\", instead of every pi steps*/\"tanf\": function (x) { return Math.tan(x / (128 / Math.PI)) },\r\n\t\t\t/*converts t into a string composed of it's bits, regex's that*/\"regG\": function (t, X) { return X.test(t.toString(2)) },\r\n\r\n\t\t\t\"saw\": t => t % 256,\r\n\t\t\t\"tri\": t => Math.abs((t % 512) - 256),\r\n\t\t\t\"sq\": t => t % 256 < 128 ? 255 : 0,\r\n\t\t\t\"audioIN\": (index, channel = 0, file = 0) => {\r\n\t\t\t\tconst audioFile = this.audioFiles.get(file);\r\n\t\t\t\tif (!audioFile || !audioFile.data) return 0;\r\n\t\t\t\tconst sampleIndex = Math.floor(index) + (channel % audioFile.channels);\r\n\t\t\t\treturn audioFile.data[sampleIndex] || 0;\r\n\t\t\t},\r\n\t\t\t\"audioLength\": (file = 0) => {\r\n\t\t\t\tconst audioFile = this.audioFiles.get(file);\r\n\t\t\t\treturn audioFile ? audioFile.data.length : 0;\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\tparams.push('int', 'window', ...Object.keys(funcs));\r\n\t\tvalues.push(Math.floor, globalThis, ...Object.values(funcs));\r\n\t\taudioProcessor.deleteGlobals();\r\n\t\t// Code testing\r\n\t\tlet isCompiled = false;\r\n\t\tconst oldFunc = this.func;\r\n\t\ttry {\r\n\t\t\tif(this.isFuncbeat) {\r\n\t\t\t\tthis.func = new Function(...params, codeText).bind(globalThis, ...values);\r\n\t\t\t} else {\r\n\t\t\t\t// Optimize code like eval(unescape(escape`XXXX`.replace(/u(..)/g,\"$1%\")))\r\n\t\t\t\tcodeText = codeText.trim().replace(\r\n\t\t\t\t\t/^eval\\(unescape\\(escape(?:`|\\('|\\(\"|\\(`)(.*?)(?:`|'\\)|\"\\)|`\\)).replace\\(\\/u\\(\\.\\.\\)\\/g,[\"'`]\\$1%[\"'`]\\)\\)\\)$/,\r\n\t\t\t\t\t(match, m1) => unescape(escape(m1).replace(/u(..)/g, '$1%')));\r\n\t\t\t\tthis.func = new Function(...params, 't', `return 0,\\n${ codeText || 0 };`)\r\n\t\t\t\t\t.bind(globalThis, ...values);\r\n\t\t\t}\r\n\t\t\tisCompiled = true;\r\n\t\t\tif(this.isFuncbeat) {\r\n\t\t\t\tthis.func = this.func();\r\n\t\t\t\tthis.func(0, this.sampleRate);\r\n\t\t\t} else {\r\n\t\t\t\tthis.func(0);\r\n\t\t\t}\r\n\t\t} catch(err) {\r\n\t\t\tif(!isCompiled) {\r\n\t\t\t\tthis.func = oldFunc;\r\n\t\t\t}\r\n\t\t\tthis.errorDisplayed = false;\r\n\t\t\tthis.sendData({\r\n\t\t\t\terror: { message: audioProcessor.getErrorMessage(err, isCompiled ? 0 : null), isCompiled },\r\n\t\t\t\tupdateUrl: isCompiled\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.errorDisplayed = false;\r\n\t\tthis.sendData({ error: { message: '', isCompiled }, updateUrl: true });\r\n\t}\r\n\tsetSampleRatio(sampleRatio) {\r\n\t\tconst timeOffset = Math.floor(this.sampleRatio * this.audioSample) - this.lastTime;\r\n\t\tthis.sampleRatio = sampleRatio * this.playbackSpeed;\r\n\t\tthis.lastTime = Math.floor(this.sampleRatio * this.audioSample) - timeOffset;\r\n\t}\r\n}\r\n\r\nregisterProcessor('audioProcessor', audioProcessor);\r\n"],"names":["audioProcessor","AudioWorkletProcessor","constructor","args","super","this","audioSample","byteSample","drawMode","errorDisplayed","func","getValues","isFuncbeat","isPlaying","lastByteValue","lastFuncValue","lastTime","outValue","playbackSpeed","sampleRate","sampleRatio","srDivisor","fftBuffer","fftSize","audioFiles","Map","Object","seal","deleteGlobals","freezeGlobals","port","addEventListener","e","receiveData","data","start","i","globalThis","String","fromCharCode","name","prototype","hasOwnProperty","call","getOwnPropertyNames","forEach","prop","type","freeze","defineProperty","writable","configurable","getErrorMessage","err","time","when","Error","JSON","stringify","message","lineNumber","columnNumber","process","inputs","chData","chDataLen","length","drawBuffer","isDiagram","currentTime","Math","floor","funcValue","currentSample","sendData","error","isRuntime","NaN","Array","isArray","hasValue","ch","isNaN","push","t","value","abs","Number","MAX_SAFE_INTEGER","resetTime","isSend","sample","fftData","slice","undefined","resetValues","setSampleRatio","mode","max","min","round","setFunction","postMessage","codeText","params","values","map","k","funcs","bitC","x","y","z","br","size","result","idx","sinf","sin","PI","cosf","cos","tanf","tan","regG","X","test","toString","saw","tri","sq","audioIN","index","channel","file","audioFile","get","sampleIndex","channels","audioLength","keys","isCompiled","oldFunc","Function","bind","trim","replace","match","m1","unescape","escape","updateUrl","timeOffset","registerProcessor"],"mappings":"AAAA,MAAMA,UAAuBC,sBAC5B,WAAAC,IAAeC,GACdC,SAASD,GACTE,KAAKC,YAAc,EACnBD,KAAKE,WAAa,EAClBF,KAAKG,SAAW,SAChBH,KAAKI,gBAAiB,EACtBJ,KAAKK,KAAO,KACZL,KAAKM,UAAY,KACjBN,KAAKO,YAAa,EAClBP,KAAKQ,WAAY,EACjBR,KAAKS,cAAgB,CAAC,KAAM,MAC5BT,KAAKU,cAAgB,CAAC,KAAM,MAC5BV,KAAKW,UAAY,EACjBX,KAAKY,SAAW,CAAC,EAAG,GACpBZ,KAAKa,cAAgB,EACrBb,KAAKc,WAAa,IAClBd,KAAKe,YAAc,EACnBf,KAAKgB,UAAY,EACjBhB,KAAKiB,UAAY,GACjBjB,KAAKkB,QAAU,IACflB,KAAKmB,WAAa,IAAIC,IACtBC,OAAOC,KAAKtB,MACZL,EAAe4B,gBACf5B,EAAe6B,gBACfxB,KAAKyB,KAAKC,iBAAiB,WAAWC,GAAK3B,KAAK4B,YAAYD,EAAEE,QAC9D7B,KAAKyB,KAAKK,OACV,CACD,oBAAOP,GAEN,IAAI,IAAIQ,EAAI,EAAGA,EAAI,KAAMA,SACjBC,WAAWC,OAAOC,aAAa,GAAKH,WACpCC,WAAWC,OAAOC,aAAa,GAAKH,IAG5C,IAAI,MAAMI,KAAQH,WACdX,OAAOe,UAAUC,eAAeC,KAAKN,WAAYG,WAC5CH,WAAWG,EAGpB,CACD,oBAAOX,GACNH,OAAOkB,oBAAoBP,YAAYQ,SAAQL,IAC9C,MAAMM,EAAOT,WAAWG,GAClBO,SAAcD,EACP,WAATC,GAA8B,aAATA,GAAiC,eAATP,GAChDd,OAAOsB,OAAOF,GAEH,aAATC,GAAuBrB,OAAOe,UAAUC,eAAeC,KAAKG,EAAM,cACpEpB,OAAOsB,OAAOF,EAAKL,WAEpBf,OAAOuB,eAAeZ,WAAYG,EAAM,CAAEU,UAAU,EAAOC,cAAc,GAAQ,GAElF,CACD,sBAAOC,CAAgBC,EAAKC,GAC3B,MAAMC,EAAgB,OAATD,EAAgB,cAAgB,KAAOA,EACpD,KAAKD,aAAeG,OACnB,MAAO,GAAID,aAAiC,iBAARF,EAAmBA,EAAMI,KAAKC,UAAUL,KAE7E,MAAMM,QAAEA,EAAOC,WAAEA,EAAUC,aAAEA,GAAiBR,EAC9C,MAAO,GAAIE,YAAoC,iBAAZI,EAAuBA,EAAUF,KAAKC,UAAUC,KAC5D,iBAAfC,GAAmD,iBAAjBC,EACxC,aAAcD,EAAa,iBAAmBC,KAAmB,IACnE,CACD,OAAAC,CAAQC,GAASC,IAChB,MAAMC,EAAYD,EAAO,GAAGE,OAC5B,IAAID,IAAc5D,KAAKQ,UACtB,OAAO,EAER,IAAIyC,EAAOjD,KAAKe,YAAcf,KAAKC,aAC/BC,WAAEA,GAAeF,KACrB,MAAM8D,EAAa,GACbC,EAA8B,aAAlB/D,KAAKG,UAA6C,YAAlBH,KAAKG,SACvD,IAAI,IAAI4B,EAAI,EAAGA,EAAI6B,IAAa7B,EAAG,CAClCkB,GAAQjD,KAAKe,YAEb,MAAMiD,EAAcC,KAAKC,MAAMjB,GAC/B,GAAGjD,KAAKW,WAAaqD,EAAa,CACjC,IAAIG,EACJ,MAAMC,EAAgBH,KAAKC,MAAMhE,EAAWF,KAAKgB,WAAahB,KAAKgB,UACnE,IAEEmD,EADEnE,KAAKO,WACKP,KAAKK,KAAK+D,EAAcpE,KAAKc,WAAYd,KAAKc,WAAWd,KAAKgB,WAE9DhB,KAAKK,KAAK+D,EAEvB,CAAC,MAAMpB,GACJhD,KAAKI,iBACPJ,KAAKI,gBAAiB,EACtBJ,KAAKqE,SAAS,CACbC,MAAO,CACNhB,QAAS3D,EAAeoD,gBAAgBC,EAAKoB,GAC7CG,WAAW,MAIdJ,EAAYK,GACZ,CACDL,EAAYM,MAAMC,QAAQP,GAAa,CAACA,EAAU,GAAIA,EAAU,IAAM,CAACA,EAAWA,GAClF,IAAIQ,GAAW,EACXC,EAAK,EACT,KAAMA,KAAM,CACX,IACCT,EAAUS,IAAOT,EAAUS,EAC3B,CAAC,MAAM5B,GACPmB,EAAUS,GAAMJ,GAChB,CACET,GACEc,MAAMV,EAAUS,IAGnB5E,KAAKS,cAAcmE,GAAMJ,IAFzBxE,KAAKY,SAASgE,GAAM5E,KAAKM,UAAU6D,EAAUS,GAAKA,GAInDD,GAAW,GAGTR,EAAUS,KAAQ5E,KAAKU,cAAckE,KAE7BC,MAAMV,EAAUS,IAGhBC,MAAM7E,KAAKU,cAAckE,MACnC5E,KAAKS,cAAcmE,GAAMJ,IACzBG,GAAW,IAJX3E,KAAKY,SAASgE,GAAM5E,KAAKM,UAAU6D,EAAUS,GAAKA,GAClDD,GAAW,GAKZ,CACEA,GACFb,EAAWgB,KAAK,CAAEC,EAAG7E,EAAY8E,MAAO,IAAIhF,KAAKS,iBAGlDP,GAAc8D,EAAchE,KAAKW,SACjCX,KAAKU,cAAgByD,EACrBnE,KAAKW,SAAWqD,CAChB,CACDL,EAAO,GAAG5B,GAAK/B,KAAKY,SAAS,GAC7B+C,EAAO,GAAG5B,GAAK/B,KAAKY,SAAS,EAC7B,CACD,GAAGqD,KAAKgB,IAAI/E,GAAcgF,OAAOC,iBAEhC,OADAnF,KAAKoF,aACE,EAERpF,KAAKC,aAAe2D,EACpB,IAAIyB,GAAS,EACb,MAAMxD,EAAO,CAAA,EAKb,GAJG3B,IAAeF,KAAKE,aACtBmF,GAAS,EACTxD,EAAK3B,WAAaF,KAAKE,WAAaA,GAElC4D,EAAWD,OAAQ,CACrBwB,GAAS,EACTxD,EAAKiC,WAAaA,EAElB,IAAI,MAAMwB,KAAUxB,EACnB9D,KAAKiB,UAAU6D,MAAMQ,EAAON,MAAM,GAAKM,EAAON,MAAM,IAAM,GAExDhF,KAAKiB,UAAU4C,QAAU7D,KAAKkB,UAChCW,EAAK0D,QAAUvF,KAAKiB,UAAUuE,OAAOxF,KAAKkB,SAC1ClB,KAAKiB,UAAYjB,KAAKiB,UAAUuE,OAAOxF,KAAKkB,SAE7C,CAID,OAHGmE,GACFrF,KAAKqE,SAASxC,IAER,CACP,CACD,WAAAD,CAAYC,GAeX,QAduB4D,IAApB5D,EAAK3B,aACPF,KAAKE,YAAc2B,EAAK3B,YAAc,EACtCF,KAAK0F,gBAEqB,IAAxB7D,EAAKzB,iBACPJ,KAAKI,gBAAiB,QAEDqF,IAAnB5D,EAAKrB,YACPR,KAAKQ,UAAYqB,EAAKrB,gBAGDiF,IAAnB5D,EAAKb,YACPhB,KAAKgB,UAAYa,EAAKb,gBAEGyE,IAAvB5D,EAAKhB,cAA6B,CACpC,MAAME,EAAcf,KAAKe,YAAcf,KAAKa,cAC5Cb,KAAKa,cAAgBgB,EAAKhB,cAC1Bb,KAAK2F,eAAe5E,EACpB,CACD,QAAiB0E,IAAd5D,EAAK+D,KAEP,OADA5F,KAAKO,WAA2B,aAAdsB,EAAK+D,KAChB/D,EAAK+D,MACZ,IAAK,WACJ5F,KAAKM,UAAY,CAAC6D,EAAWS,KAAQ5E,KAAKS,cAAcmE,GAAkB,IAAZT,GAAmB,MAAQ,EACzF,MACD,IAAK,kBACJnE,KAAKM,UAAY,CAAC6D,EAAWS,KAC3B5E,KAAKS,cAAcmE,GAAOT,EAAY,IAAO,KAAO,MAAQ,EAC9D,MACD,IAAK,YACL,IAAK,WACJnE,KAAKM,UAAY,CAAC6D,EAAWS,KAC5B,MAAMhE,EAAWqD,KAAK4B,IAAI5B,KAAK6B,IAAI3B,EAAW,IAAK,GAEnD,OADAnE,KAAKS,cAAcmE,GAAMX,KAAK8B,MAAuB,OAAhBnF,EAAW,IACzCA,CAAQ,EAEhB,MACD,QAASZ,KAAKM,UAAY,CAAC6D,EAAWS,IAAQ5E,KAAKS,cAAcmE,GAAMJ,SAGnDiB,IAAlB5D,EAAK1B,WACPH,KAAKG,SAAW0B,EAAK1B,eAEEsF,IAArB5D,EAAKmE,aACPhG,KAAKgG,YAAYnE,EAAKmE,cAED,IAAnBnE,EAAKuD,WACPpF,KAAKoF,iBAEiBK,IAApB5D,EAAKf,aACPd,KAAKc,WAAae,EAAKf,iBAEA2E,IAArB5D,EAAKd,aACPf,KAAK2F,eAAe9D,EAAKd,kBAEH0E,IAApB5D,EAAKV,aACPnB,KAAKmB,WAAa,IAAIC,IAAIS,EAAKV,YAEhC,CACD,QAAAkD,CAASxC,GACR7B,KAAKyB,KAAKwE,YAAYpE,EACtB,CACD,SAAAuD,GACCpF,KAAKE,WAAa,EAClBF,KAAK0F,cACL1F,KAAKqE,SAAS,CAAEnE,WAAY,GAC5B,CACD,WAAAwF,GACC1F,KAAKC,YAAc,EACnBD,KAAKS,cAAgBT,KAAKU,cAAgB,CAAC,KAAM,MACjDV,KAAKW,UAAY,EACjBX,KAAKY,SAAW,CAAC,EAAG,EACpB,CACD,WAAAoF,CAAYE,GAEX,MAAMC,EAAS9E,OAAOkB,oBAAoB0B,MACpCmC,EAASD,EAAOE,KAAIC,GAAKrC,KAAKqC,KAE9BC,EAAQ,CACEC,KAAQ,SAAUC,EAAGC,EAAGC,GAAK,OAAOF,EAAIC,EAAIC,EAAI,CAAG,EACnDC,GAAM,SAAUH,EAAGI,EAAO,GACxC,GAAIA,EAAO,GAAM,MAAM,IAAI1D,MAAM,uCAA8C,CAC9E,IAAI2D,EAAS,EACb,IAAK,IAAIC,EAAM,EAAGA,EAAOF,EAAO,EAAIE,IACnCD,GAAUP,EAAMC,KAAKC,EAAG,GAAKM,EAAK,IAAMF,GAAQE,EAAM,KAEvD,OAAOD,CACP,CACD,EAC8DE,KAAQ,SAAUP,GAAK,OAAOxC,KAAKgD,IAAIR,GAAK,IAAMxC,KAAKiD,IAAM,EAC7DC,KAAQ,SAAUV,GAAK,OAAOxC,KAAKmD,IAAIX,GAAK,IAAMxC,KAAKiD,IAAM,EAC7DG,KAAQ,SAAUZ,GAAK,OAAOxC,KAAKqD,IAAIb,GAAK,IAAMxC,KAAKiD,IAAM,EAC5DK,KAAQ,SAAUxC,EAAGyC,GAAK,OAAOA,EAAEC,KAAK1C,EAAE2C,SAAS,GAAK,EAExHC,IAAO5C,GAAKA,EAAI,IAChB6C,IAAO7C,GAAKd,KAAKgB,IAAKF,EAAI,IAAO,KACjC8C,GAAM9C,GAAKA,EAAI,IAAM,IAAM,IAAM,EACjC+C,QAAW,CAACC,EAAOC,EAAU,EAAGC,EAAO,KACtC,MAAMC,EAAYlI,KAAKmB,WAAWgH,IAAIF,GACtC,IAAKC,IAAcA,EAAUrG,KAAM,OAAO,EAC1C,MAAMuG,EAAcnE,KAAKC,MAAM6D,GAAUC,EAAUE,EAAUG,SAC7D,OAAOH,EAAUrG,KAAKuG,IAAgB,CAAC,EAExCE,YAAe,CAACL,EAAO,KACtB,MAAMC,EAAYlI,KAAKmB,WAAWgH,IAAIF,GACtC,OAAOC,EAAYA,EAAUrG,KAAKgC,OAAS,CAAC,GAI9CsC,EAAOrB,KAAK,MAAO,YAAazD,OAAOkH,KAAKhC,IAC5CH,EAAOtB,KAAKb,KAAKC,MAAOlC,cAAeX,OAAO+E,OAAOG,IACrD5G,EAAe4B,gBAEf,IAAIiH,GAAa,EACjB,MAAMC,EAAUzI,KAAKK,KACrB,IACIL,KAAKO,WACPP,KAAKK,KAAO,IAAIqI,YAAYvC,EAAQD,GAAUyC,KAAK3G,cAAeoE,IAGlEF,EAAWA,EAAS0C,OAAOC,QAC1B,gHACA,CAACC,EAAOC,IAAOC,SAASC,OAAOF,GAAIF,QAAQ,SAAU,UACtD7I,KAAKK,KAAO,IAAIqI,YAAYvC,EAAQ,IAAK,cAAeD,GAAY,MAClEyC,KAAK3G,cAAeoE,IAEvBoC,GAAa,EACVxI,KAAKO,YACPP,KAAKK,KAAOL,KAAKK,OACjBL,KAAKK,KAAK,EAAGL,KAAKc,aAElBd,KAAKK,KAAK,EAEX,CAAC,MAAM2C,GASP,OARIwF,IACHxI,KAAKK,KAAOoI,GAEbzI,KAAKI,gBAAiB,OACtBJ,KAAKqE,SAAS,CACbC,MAAO,CAAEhB,QAAS3D,EAAeoD,gBAAgBC,EAAKwF,EAAa,EAAI,MAAOA,cAC9EU,UAAWV,GAGZ,CACDxI,KAAKI,gBAAiB,EACtBJ,KAAKqE,SAAS,CAAEC,MAAO,CAAEhB,QAAS,GAAIkF,cAAcU,WAAW,GAC/D,CACD,cAAAvD,CAAe5E,GACd,MAAMoI,EAAalF,KAAKC,MAAMlE,KAAKe,YAAcf,KAAKC,aAAeD,KAAKW,SAC1EX,KAAKe,YAAcA,EAAcf,KAAKa,cACtCb,KAAKW,SAAWsD,KAAKC,MAAMlE,KAAKe,YAAcf,KAAKC,aAAekJ,CAClE,EAGFC,kBAAkB,iBAAkBzJ"}